<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Social Spiral Game - Player</title>
    <script src="/socket.io/socket.io.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #2c3e50 0%, #3498db 100%);
            min-height: 100vh;
            padding: 1rem;
        }

        .container {
            max-width: 420px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.15);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(45deg, #2c3e50, #3498db);
            color: white;
            padding: 2rem 1.5rem;
            text-align: center;
        }

        .header h1 {
            font-size: 1.8rem;
            margin-bottom: 0.5rem;
        }

        .header p {
            opacity: 0.9;
            font-size: 0.95rem;
        }

        .content {
            padding: 2rem 1.5rem;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: #333;
        }

        .form-group input, .form-group select {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e1e5e9;
            border-radius: 10px;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
        }

        .pawn-selector {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 0.8rem;
            margin-top: 0.5rem;
        }

        .pawn-option {
            padding: 1rem;
            border: 2px solid #e1e5e9;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            background: white;
            position: relative;
        }

        .pawn-option:hover {
            border-color: #3498db;
            background: #f8fafe;
        }

        .pawn-option.selected {
            border-color: #2c3e50;
            background: #ecf0f1;
            transform: scale(1.02);
        }

        .pawn-option.disabled {
            opacity: 0.4;
            cursor: not-allowed;
            background: #f8f9fa;
        }

        .pawn-option.disabled:hover {
            border-color: #e1e5e9;
            background: #f8f9fa;
            transform: none;
        }

        .pawn-icon {
            font-size: 1.5rem;
            margin-bottom: 0.3rem;
        }

        .pawn-label {
            font-size: 0.85rem;
            font-weight: 500;
            color: #333;
            line-height: 1.2;
        }

        .button {
            width: 100%;
            background: linear-gradient(45deg, #2c3e50, #3498db);
            color: white;
            border: none;
            padding: 15px;
            border-radius: 10px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 1rem;
        }

        .button:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .button:disabled {
            background: #bdc3c7;
            cursor: not-allowed;
            transform: none;
        }

        .button.draw-card {
            background: linear-gradient(45deg, #f39c12, #e67e22);
            font-size: 1.2rem;
            padding: 18px;
            margin-bottom: 1rem;
        }

        .button.move-forward {
            background: linear-gradient(45deg, #27ae60, #2ecc71);
            margin-bottom: 0.5rem;
        }

        .button.move-backward {
            background: linear-gradient(45deg, #e74c3c, #c0392b);
        }

        .movement-buttons {
            display: flex;
            gap: 0.5rem;
            margin-top: 1rem;
        }

        .movement-buttons .button {
            margin-top: 0;
            flex: 1;
        }

        .status-message {
            padding: 1rem;
            border-radius: 10px;
            margin: 1rem 0;
            text-align: center;
            font-weight: 600;
        }

        .status-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .status-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .status-info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }

        .game-status {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 1.5rem;
            margin: 1rem 0;
            text-align: center;
        }

        .player-info {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .player-pawn {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            border: 3px solid #2c3e50;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            background: white;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .position-display {
            background: linear-gradient(45deg, #2c3e50, #3498db);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-weight: bold;
            font-size: 1.1rem;
        }

        .waiting-room {
            text-align: center;
            padding: 2rem 0;
        }

        .waiting-room h3 {
            color: #333;
            margin-bottom: 1rem;
        }

        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 1rem auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .game-info {
            background: #e8f4fd;
            border-radius: 12px;
            padding: 1.2rem;
            margin: 1rem 0;
            border-left: 4px solid #3498db;
        }

        .game-info h4 {
            color: #2c3e50;
            margin-bottom: 0.5rem;
            font-size: 1.1rem;
        }

        .game-info p {
            color: #34495e;
            font-size: 0.95rem;
            line-height: 1.4;
        }

        .difficulty-badge {
            display: inline-block;
            padding: 0.3rem 0.8rem;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
        }

        .difficulty-basic {
            background: #d4edda;
            color: #155724;
        }

        .difficulty-intermediate {
            background: #fff3cd;
            color: #856404;
        }

        .difficulty-advanced {
            background: #f8d7da;
            color: #721c24;
        }

        .other-players {
            margin-top: 1.5rem;
        }

        .other-players h4 {
            color: #333;
            margin-bottom: 1rem;
            text-align: center;
        }

        .players-list {
            display: flex;
            flex-direction: column;
            gap: 0.8rem;
        }

        .other-player {
            background: white;
            border-radius: 12px;
            padding: 1rem;
            display: flex;
            align-items: center;
            gap: 1rem;
            border: 2px solid #ecf0f1;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }

        .other-player-pawn {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            border: 2px solid #2c3e50;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            background: white;
        }

        .player-details {
            flex: 1;
        }

        .player-name {
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 0.2rem;
        }

        .player-position {
            font-size: 0.9rem;
            color: #7f8c8d;
        }

        .turn-indicator {
            background: linear-gradient(45deg, #27ae60, #2ecc71);
            color: white;
            padding: 1rem;
            border-radius: 12px;
            text-align: center;
            font-weight: bold;
            margin: 1rem 0;
            animation: pulse 2s infinite;
        }

        .turn-waiting {
            background: linear-gradient(45deg, #95a5a6, #7f8c8d);
            animation: none;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.02); }
            100% { transform: scale(1); }
        }

        .card-display {
            background: #fff9e6;
            border: 2px solid #f39c12;
            border-radius: 12px;
            padding: 1.5rem;
            margin: 1rem 0;
            text-align: center;
        }

        .card-type {
            font-weight: bold;
            color: #d35400;
            margin-bottom: 0.5rem;
            font-size: 1.1rem;
        }

        .card-text {
            color: #8b4513;
            font-size: 1rem;
            line-height: 1.4;
            margin-bottom: 1rem;
        }

        .card-instruction {
            background: #e8f5e8;
            border-radius: 8px;
            padding: 0.8rem;
            color: #1e8449;
            font-weight: 600;
            font-size: 0.9rem;
        }

        .winner-announcement {
            background: linear-gradient(45deg, #f1c40f, #f39c12);
            color: #2c3e50;
            padding: 2rem;
            border-radius: 15px;
            text-align: center;
            margin: 1rem 0;
        }

        .winner-announcement h2 {
            font-size: 2rem;
            margin-bottom: 1rem;
        }

        .reflection-prompt {
            background: #e8f5e8;
            border: 2px solid #27ae60;
            border-radius: 12px;
            padding: 1.2rem;
            margin: 1rem 0;
        }

        .reflection-prompt h4 {
            color: #1e8449;
            margin-bottom: 0.8rem;
        }

        .reflection-prompt p {
            color: #2d5016;
            line-height: 1.5;
        }

        .current-turn-info {
            background: linear-gradient(45deg, #3498db, #2980b9);
            color: white;
            padding: 1rem;
            border-radius: 12px;
            text-align: center;
            margin: 1rem 0;
            font-weight: 600;
        }

        @media (max-width: 480px) {
            .container {
                margin: 0;
                border-radius: 0;
                min-height: 100vh;
            }
            
            .pawn-selector {
                grid-template-columns: 1fr;
            }
            
            .pawn-option {
                padding: 0.8rem;
            }

            .movement-buttons {
                flex-direction: column;
                gap: 0.5rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üéØ Social Spiral Game</h1>
            <p>Understanding Social Inequalities</p>
        </div>

        <div class="content">
            <!-- Join Game Form -->
            <div id="joinForm">
                <div class="form-group">
                    <label for="playerName">Your Name</label>
                    <input type="text" id="playerName" placeholder="Enter your name" maxlength="20">
                </div>

                <div class="form-group">
                    <label for="roomCode">Room Code</label>
                    <input type="text" id="roomCode" placeholder="Enter room code" maxlength="6" style="text-transform: uppercase;">
                </div>

                <div class="form-group">
                    <label>Choose the identity you most identify with:</label>
                    <div id="pawnSelector" class="pawn-selector">
                        <!-- Pawns will be populated by JavaScript -->
                    </div>
                </div>

                <button id="joinBtn" class="button" disabled>Join Game</button>
            </div>

            <!-- Status Messages -->
            <div id="statusMessage" style="display: none;"></div>

            <!-- Waiting Room -->
            <div id="waitingRoom" style="display: none;">
                <div class="waiting-room">
                    <h3>Successfully Joined!</h3>
                    <div class="loading-spinner"></div>
                    <p>Waiting for teacher to start the game...</p>
                </div>

                <div class="game-status">
                    <div class="player-info">
                        <div id="playerPawn" class="player-pawn"></div>
                        <div>
                            <div class="player-name" id="playerDisplayName">Player</div>
                            <div class="position-display">Ring: <span id="playerPosition">21</span></div>
                        </div>
                    </div>
                </div>

                <div class="other-players">
                    <h4>Other Players (<span id="otherPlayerCount">0</span>)</h4>
                    <div id="otherPlayersList" class="players-list"></div>
                </div>
            </div>

            <!-- Game Active -->
            <div id="gameActive" style="display: none;">
                <div class="game-info">
                    <div id="difficultyBadge" class="difficulty-badge difficulty-basic">Basic Level</div>
                    <h4>Game Instructions</h4>
                    <p>When it's your turn, draw a card and decide whether to move forward or backward based on your experience with the situation described.</p>
                </div>

                <div class="game-status">
                    <div class="player-info">
                        <div id="gamePlayerPawn" class="player-pawn"></div>
                        <div>
                            <div class="player-name" id="gamePlayerName">Player</div>
                            <div class="position-display">Ring: <span id="gamePlayerPosition">21</span></div>
                        </div>
                    </div>
                </div>

                <!-- Turn Information -->
                <div id="turnIndicator" class="turn-indicator turn-waiting">
                    Waiting for your turn...
                </div>

                <div id="currentTurnInfo" class="current-turn-info" style="display: none;">
                    It's <span id="currentPlayerName"></span>'s turn
                </div>

                <!-- Card Drawing Section -->
                <div id="cardDrawSection" style="display: none;">
                    <button id="drawCardBtn" class="button draw-card">üé¥ Draw Card</button>
                </div>

                <!-- Card Display -->
                <div id="cardDisplay" class="card-display" style="display: none;">
                    <div class="card-type" id="cardType">Card Type</div>
                    <div class="card-text" id="cardText">Card content will appear here</div>
                    <div class="card-instruction">
                        Choose your response based on your identity and experiences
                    </div>
                    
                    <div class="movement-buttons">
                        <button id="moveForwardBtn" class="button move-forward">‚¨ÜÔ∏è Move Forward</button>
                        <button id="moveBackwardBtn" class="button move-backward">‚¨áÔ∏è Move Backward</button>
                    </div>
                </div>

                <div class="other-players">
                    <h4>Other Players</h4>
                    <div id="gameOtherPlayersList" class="players-list"></div>
                </div>
            </div>

            <!-- Winner Announcement -->
            <div id="winnerAnnouncement" class="winner-announcement" style="display: none;">
                <h2>üèÜ Game Complete!</h2>
                <p id="winnerText"></p>
                
                <div class="reflection-prompt">
                    <h4>Time for Reflection</h4>
                    <p>Discuss with your teacher and classmates about the different positions of the pawns and what this reveals about social inequalities in our society.</p>
                </div>
                
                <button class="button" onclick="location.reload()">Play Again</button>
            </div>
        </div>
    </div>

    <script>
        const socket = io();
        let gameState = {
            playerData: null,
            roomCode: null,
            selectedPawn: null,
            players: [],
            currentPlayer: null,
            gameStarted: false,
            gameLevel: 'basic',
            isMyTurn: false,
            currentCard: null,
            cardCategories: ['privileges', 'social_policies', 'behaviors']
        };

        // Available identity pawns
        const IDENTITY_PAWNS = [
            { id: 'white_man', icon: 'üë®üèª', label: 'White Man', color: '#3498db' },
            { id: 'white_woman', icon: 'üë©üèª', label: 'White Woman', color: '#e74c3c' },
            { id: 'black_man', icon: 'üë®üèø', label: 'Black Man', color: '#8e44ad' },
            { id: 'black_woman', icon: 'üë©üèø', label: 'Black Woman', color: '#e67e22' },
            { id: 'lgbtiqa', icon: 'üè≥Ô∏è‚Äçüåà', label: 'LGBTIQA+', color: '#f39c12' },
            { id: 'blind', icon: 'ü¶Ø', label: 'Blind Person', color: '#16a085' },
            { id: 'deaf', icon: 'ü§ü', label: 'Deaf Person', color: '#2980b9' },
            { id: 'disabled', icon: '‚ôø', label: 'Physically Disabled', color: '#c0392b' },
            { id: 'elderly', icon: 'üë¥', label: 'Elderly Person', color: '#7f8c8d' },
            { id: 'neutral', icon: 'üë§', label: 'Neutral', color: '#34495e' }
        ];

        // Sample cards for different categories
        const SAMPLE_CARDS = {
            privileges: [
                "You can easily find beauty products that match your skin tone.",
                "You've never been followed by security in a store.",
                "Your achievements are never questioned as diversity hires.",
                "You can walk alone at night without fear.",
                "Your name is never mispronounced or seen as 'difficult'.",
                "You see people who look like you in leadership positions.",
                "You've never been asked to speak for your entire race/group."
            ],
            social_policies: [
                "A new accessibility law is passed requiring ramps in all buildings.",
                "Healthcare becomes free for all citizens.",
                "Marriage equality is legalized nationwide.",
                "Anti-discrimination laws in employment are strengthened.",
                "Public transportation becomes wheelchair accessible.",
                "Mental health support is included in all health plans.",
                "Educational funding is distributed more equally across districts."
            ],
            behaviors: [
                "You interrupt others in meetings without being called aggressive.",
                "You can express anger without being labeled as 'difficult'.",
                "Your cultural holidays are recognized by your workplace/school.",
                "You can make mistakes without them being attributed to your identity.",
                "You receive mentorship and networking opportunities easily.",
                "Your accent or way of speaking is considered 'professional'.",
                "You can discuss your weekend activities without hiding your identity."
            ]
        };

        // DOM elements
        const joinForm = document.getElementById('joinForm');
        const playerNameInput = document.getElementById('playerName');
        const roomCodeInput = document.getElementById('roomCode');
        const pawnSelector = document.getElementById('pawnSelector');
        const joinBtn = document.getElementById('joinBtn');
        const statusMessage = document.getElementById('statusMessage');
        const waitingRoom = document.getElementById('waitingRoom');
        const gameActive = document.getElementById('gameActive');
        const winnerAnnouncement = document.getElementById('winnerAnnouncement');
        const turnIndicator = document.getElementById('turnIndicator');
        const cardDrawSection = document.getElementById('cardDrawSection');
        const cardDisplay = document.getElementById('cardDisplay');
        const drawCardBtn = document.getElementById('drawCardBtn');
        const moveForwardBtn = document.getElementById('moveForwardBtn');
        const moveBackwardBtn = document.getElementById('moveBackwardBtn');

        // Initialize pawn selector
        function initializePawnSelector() {
            pawnSelector.innerHTML = '';
            IDENTITY_PAWNS.forEach(pawn => {
                const pawnOption = document.createElement('div');
                pawnOption.className = 'pawn-option';
                pawnOption.innerHTML = `
                    <div class="pawn-icon">${pawn.icon}</div>
                    <div class="pawn-label">${pawn.label}</div>
                `;
                pawnOption.addEventListener('click', () => selectPawn(pawn));
                pawnSelector.appendChild(pawnOption);
            });
        }

        // Select pawn
        function selectPawn(pawn) {
            const pawnOptions = document.querySelectorAll('.pawn-option');
            pawnOptions.forEach(option => option.classList.remove('selected'));
            
            const selectedOption = Array.from(pawnOptions).find(option => 
                option.querySelector('.pawn-label').textContent === pawn.label
            );
            if (selectedOption && !selectedOption.classList.contains('disabled')) {
                selectedOption.classList.add('selected');
                gameState.selectedPawn = pawn;
                updateJoinButton();
            }
        }

        // Update join button state
        function updateJoinButton() {
            const canJoin = playerNameInput.value.trim() && 
                           roomCodeInput.value.trim() && 
                           gameState.selectedPawn;
            joinBtn.disabled = !canJoin;
        }

        // Event listeners
        playerNameInput.addEventListener('input', updateJoinButton);
        roomCodeInput.addEventListener('input', (e) => {
            e.target.value = e.target.value.toUpperCase();
            updateJoinButton();
        });

        joinBtn.addEventListener('click', () => {
            const playerName = playerNameInput.value.trim();
            const roomCode = roomCodeInput.value.trim();
            
            if (playerName && roomCode && gameState.selectedPawn) {
                socket.emit('join-room', {
                    roomCode: roomCode,
                    playerName: playerName,
                    playerPawn: gameState.selectedPawn
                });
            }
        });

        drawCardBtn.addEventListener('click', () => {
            drawCard();
        });

        moveForwardBtn.addEventListener('click', () => {
            makeMove('forward');
        });

        moveBackwardBtn.addEventListener('click', () => {
            makeMove('backward');
        });

        // Card drawing function
        function drawCard() {
            const currentCategory = getCurrentCardCategory();
            const cards = SAMPLE_CARDS[currentCategory];
            const randomCard = cards[Math.floor(Math.random() * cards.length)];
            
            gameState.currentCard = {
                type: currentCategory,
                text: randomCard
            };

            displayCard(gameState.currentCard);
            cardDrawSection.style.display = 'none';
            cardDisplay.style.display = 'block';

            // Emit card drawn event
            socket.emit('card-drawn', {
                roomCode: gameState.roomCode,
                playerId: gameState.playerData.id,
                card: gameState.currentCard
            });
        }

        // Get current card category based on game level and turn
        function getCurrentCardCategory() {
            if (gameState.gameLevel === 'basic') {
                return 'privileges';
            } else if (gameState.gameLevel === 'intermediate') {
                // Alternate between privileges and social_policies
                const playerIndex = gameState.players.findIndex(p => p.id === gameState.currentPlayer);
                return playerIndex % 2 === 0 ? 'privileges' : 'social_policies';
            } else { // advanced
                // Cycle through all three categories
                const playerIndex = gameState.players.findIndex(p => p.id === gameState.currentPlayer);
                const categories = ['privileges', 'social_policies', 'behaviors'];
                return categories[playerIndex % 3];
            }
        }

        // Display card
        function displayCard(card) {
            const cardTypeElement = document.getElementById('cardType');
            const cardTextElement = document.getElementById('cardText');
            
            const cardTypeNames = {
                'privileges': 'Privileges/Discrimination Card',
                'social_policies': 'Social Policies Card',
                'behaviors': 'Behaviors Card'
            };
            
            cardTypeElement.textContent = cardTypeNames[card.type] || 'Card';
            cardTextElement.textContent = card.text;
        }

        // Make move
        function makeMove(direction) {
            socket.emit('player-move', {
                roomCode: gameState.roomCode,
                playerId: gameState.playerData.id,
                direction: direction,
                card: gameState.currentCard
            });

            // Hide card and movement buttons
            cardDisplay.style.display = 'none';
            gameState.isMyTurn = false;
            updateTurnDisplay();
        }

        // Socket events
        socket.on('joined-room', (data) => {
            gameState.playerData = data.playerData;
            gameState.roomCode = data.roomCode;
            gameState.gameLevel = data.gameLevel || 'basic';
            
            showStatus('Successfully joined the game!', 'success');
            joinForm.style.display = 'none';
            waitingRoom.style.display = 'block';
            
            updatePlayerDisplay();
        });

        socket.on('join-error', (error) => {
            showStatus(error, 'error');
            
            // If pawn is taken, refresh available pawns
            if (error.includes('already taken')) {
                // Could implement pawn refresh here
            }
        });

        socket.on('room-updated', (data) => {
            gameState.players = data.players;
            gameState.gameLevel = data.gameLevel || 'basic';
            updateOtherPlayersDisplay();
            
            // Update available pawns
            updateAvailablePawns(data.availablePawns);
        });

        socket.on('game-started', (data) => {
            gameState.gameStarted = true;
            gameState.currentPlayer = data.currentPlayer;
            gameState.gameLevel = data.gameLevel || 'basic';
            gameState.players = data.players;
            
            waitingRoom.style.display = 'none';
            gameActive.style.display = 'block';
            
            updateGameDisplay();
            updateDifficultyDisplay();
            updateTurnDisplay();
        });

        socket.on('turn-changed', (data) => {
            gameState.currentPlayer = data.currentPlayer;
            gameState.players = data.players;
            updateTurnDisplay();
            updateGameDisplay();
        });

        socket.on('player-moved', (data) => {
            gameState.players = data.players;
            gameState.currentPlayer = data.nextPlayer;
            updateGameDisplay();
            updateTurnDisplay();
            
            if (data.winner) {
                showWinner(data.winner);
            }
        });

        socket.on('game-ended', (data) => {
            showWinner(data.winner);
        });

        socket.on('host-disconnected', () => {
            showStatus('Teacher disconnected. Game ended.', 'error');
            setTimeout(() => location.reload(), 3000);
        });

        // Functions
        function showStatus(message, type) {
            statusMessage.textContent = message;
            statusMessage.className = `status-message status-${type}`;
            statusMessage.style.display = 'block';
            
            setTimeout(() => {
                statusMessage.style.display = 'none';
            }, 5000);
        }


        function updatePlayerDisplay() {
            if (gameState.playerData) {
                const pawn = IDENTITY_PAWNS.find(p => p.id === gameState.playerData.pawnId);
                if (pawn) {
                    document.getElementById('playerPawn').innerHTML = pawn.icon;
                    document.getElementById('playerDisplayName').textContent = gameState.playerData.name;
                    document.getElementById('playerPosition').textContent = gameState.playerData.position;
                }
            }
        }

        function updateOtherPlayersDisplay() {
            const otherPlayers = gameState.players.filter(p => p.id !== gameState.playerData?.id);
            document.getElementById('otherPlayerCount').textContent = otherPlayers.length;
            
            const otherPlayersList = document.getElementById('otherPlayersList');
            otherPlayersList.innerHTML = '';
            
            otherPlayers.forEach(player => {
                const pawn = IDENTITY_PAWNS.find(p => p.id === player.pawnId);
                const playerElement = document.createElement('div');
                playerElement.className = 'other-player';
                playerElement.innerHTML = `
                    <div class="other-player-pawn">${pawn ? pawn.icon : 'üë§'}</div>
                    <div class="player-details">
                        <div class="player-name">${player.name}</div>
                        <div class="player-position">Ring: ${player.position}</div>
                    </div>
                `;
                otherPlayersList.appendChild(playerElement);
            });
        }

        function updateGameDisplay() {
            // Update current player info
            const currentPlayerData = gameState.players.find(p => p.id === gameState.playerData?.id);
            if (currentPlayerData) {
                const pawn = IDENTITY_PAWNS.find(p => p.id === currentPlayerData.pawnId);
                if (pawn) {
                    document.getElementById('gamePlayerPawn').innerHTML = pawn.icon;
                    document.getElementById('gamePlayerName').textContent = currentPlayerData.name;
                    document.getElementById('gamePlayerPosition').textContent = currentPlayerData.position;
                }
            }
            
            // Update other players in game view
            const otherPlayers = gameState.players.filter(p => p.id !== gameState.playerData?.id);
            const gameOtherPlayersList = document.getElementById('gameOtherPlayersList');
            gameOtherPlayersList.innerHTML = '';
            
            otherPlayers.forEach(player => {
                const pawn = IDENTITY_PAWNS.find(p => p.id === player.pawnId);
                const playerElement = document.createElement('div');
                playerElement.className = 'other-player';
                playerElement.innerHTML = `
                    <div class="other-player-pawn">${pawn ? pawn.icon : 'üë§'}</div>
                    <div class="player-details">
                        <div class="player-name">${player.name}</div>
                        <div class="player-position">Ring: ${player.position}</div>
                    </div>
                `;
                gameOtherPlayersList.appendChild(playerElement);
            });
        }

        function updateDifficultyDisplay() {
            const difficultyBadge = document.getElementById('difficultyBadge');
            difficultyBadge.className = `difficulty-badge difficulty-${gameState.gameLevel}`;
            
            const levelNames = {
                'basic': 'Basic Level',
                'intermediate': 'Intermediate Level',
                'advanced': 'Advanced Level'
            };
            
            difficultyBadge.textContent = levelNames[gameState.gameLevel] || 'Basic Level';
        }

        function showCardInfo(cardType) {
            const cardInfo = document.getElementById('cardInfo');
            const cardTypeElement = document.getElementById('cardType');
            
            const cardTypes = {
                'privileges': 'Privileges/Discrimination Card',
                'social_policies': 'Social Policies Card',
                'behaviors': 'Behaviors Card'
            };
            
            cardTypeElement.textContent = cardTypes[cardType] || 'Card Drawn';
            cardInfo.style.display = 'block';
            
            // Hide after 5 seconds
            setTimeout(() => {
                cardInfo.style.display = 'none';
            }, 5000);
        }

        function updateAvailablePawns(availablePawns) {
            const pawnOptions = document.querySelectorAll('.pawn-option');
            IDENTITY_PAWNS.forEach((pawn, index) => {
                const option = pawnOptions[index];
                if (availablePawns && availablePawns.includes(pawn.id)) {
                    option.classList.remove('disabled');
                } else if (availablePawns) {
                    option.classList.add('disabled');
                    if (gameState.selectedPawn && gameState.selectedPawn.id === pawn.id) {
                        option.classList.remove('selected');
                        gameState.selectedPawn = null;
                        updateJoinButton();
                    }
                }
            });
        }

        function showWinner(winner) {
            const winnerText = document.getElementById('winnerText');
            const isWinner = winner.id === gameState.playerData?.id;
            
            if (isWinner) {
                winnerText.innerHTML = `üéâ You reached the center first! üéâ<br>Your journey through the spiral is complete.`;
            } else {
                winnerText.innerHTML = `${winner.name} reached the center first.<br>Everyone's journey tells a different story.`;
            }
            
            gameActive.style.display = 'none';
            winnerAnnouncement.style.display = 'block';
        }

        // Initialize
        initializePawnSelector();
    </script>
</body>
</html>